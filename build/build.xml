<!DOCTYPE project []>

	<!--  O atributo default indica <target> deve -->
	<!-- executar primeiro. -->
	<project basedir="." default="copiar" name="PortalEducacao">
		<target name="init">
			<echo> Inicialização de Variáveis</echo>
			<!-- Raiz do projeto. Onde o build.xml está. -->
			<property name="root.dir" value="."/>
				
			<!-- Onde o codigo-fonte fica salvo. -->
			<property name="fontes.dir" value="${root.dir}/src" />
			
			<!-- Diretorio da instalacao do Tomcat  -->
			<property name="tomcat.dir" value="C:\Program Files\Apache Software Foundation\Tomcat 5.5" />
			 
			<!-- Diretorio onde o codigo JSP ficara salvo. -->
			<property name="web.dir" value='${root.dir}/jsp' />
			
			<!-- Diretorio auxiliar para realizar as compilacoes. -->
			<property name="build.dir" value='${root.dir}/DirGeracao' />
			
			<!-- Diretorio WEB-INF para para a geracao -->
			<property name="webinf.dir" value='${root.dir}/WEB-INF' />
			
			<!-- Diretorio onde o codigo compilado ficara -->
			<property name="classes.dir" value='${root.dir}/classes' />
			
			<!-- Diretorio onde o pacote gerado ficara -->
			<property name="dist.dir" value='${root.dir}/dist' />
			
			<!-- Nome do arquivo resultante -->
			<property name="arquivoWAR" value='PortalEducacao.war' />
			
			<!-- Diretorios que devem ser levador em consideracao na compilação -->
			<!-- Como Usamos a biblioteca do tomcat, elas precisam entrar nesse ponto. -->
			<path id="classpath">
				<fileset dir="${tomcat.dir}/common/lib" />
			</path>
		</target>
		
		<target name="clean" depends="init">
			<echo> Recriando diretorios de geracao</echo>
			<!-- Apago diretorios auxiliares, caso existam -->
			<delete dir="${build.dir}" />
			<delete dir="${dist.dir}" />
			
			<!-- Recrio diretorios auxiliares -->
			<mkdir dir="${build.dir}" />
			<mkdir dir="${dist.dir}" />
		</target>
			
		<target name="war" depends="clean">
			<echo> Gerando pacote web </echo>
			<!-- Copia de diretorio auxiliar todo o conteudo do diretorio JSP. -->
			<copy todir="${build.dir}/jsp">
				<fileset dir="${web.dir}" />
			</copy>
			
			<!-- Cria o diretorio onde o codigo compilado ficara  -->
			<mkdir dir="${classes.dir}" />
			
			<!--  Executa a compilacao, indicando onde pegar os arquivos -->
			<!--  e para onde eles deverao ser colocados levando em consideracao -->
			<!--  as bibliotecas definidas pelas variarel classpath -->
			<javac srcdir="${fontesdir}" destdir="${classes.dir}" includes="**" debug="true">
				<classpath refid="classpath" />
			</javac>
			
			<!--  Copiar o arquivo web.xml para o lugar correto. -->
			<copy todir="${webinf.dir}" file="${root}/WEB-INF/web.xml" />
			
			<!--  Compactar o diretorio auxiliar criando um arquivo unico -->
			<!--  e coloca-lo no diretorio dist para poder ser manuseado -->
			<jar destfile="${dist.dir}/${arquivoWar}">
				<fileset dir="${build.dir" />
			</jar>
			
			<delete dir="${build.dir}" />
		</target>
		
		<target name="copiar" depends="war">
			<echo> Copiando arquivo (fazendo deploy) </echo>
			<!-- Copia o arquivo gerado e que esta no dist para o diretorio webapps do tomcat -->
			<copy file="${dist.dir}/${arquivoWAR}" todir="${tomcat.dir}/webapps" />
		</target>
</project>
